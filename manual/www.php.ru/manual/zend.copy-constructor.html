<!-- 

     HTML dropped by Zend Guard Compressor 4.2

     php.ru team: mz, az, yuri, vb, cyxapuk, 440hz, administrator
     2004-2007 (c) expi-web.com 
     2007-2008 (c) odware.com 
     0101-1010 (с) 440hz

     2b|~2b=?


-->

























































































<!-- EHOT тут всё пожрал ! -->






















<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="alternate" type="application/rss+xml" title="php.ru/forum - последние сообщения" href="http://www.php.ru/forum/rss.php">
<link rel="SHORTCUT ICON" href="http://www.php.ru/favicon.ico" />
<META name="description" content="php.ru - форум PHP программистов, поиск по всем ресурсам сети, посвященным php">
<meta http-equiv="description" content="php.ru - форум PHP программистов, поиск по всем ресурсам сети, посвященным php">
<META name="keywords" content="php, php5, apache, mysql, session">
<meta http-equiv="keywords" content="php, php5, apache, mysql, session">
<title>php.ru - Duplicating Variable Contents: The Copy Constructor</title>
<LINK REL="stylesheet" TYPE="text/css" HREF="http://www.php.ru/index.css">
<script language="JavaScript" src="http://www.php.ru/ajax/ajax.js"></script>
</head>
<body>

<table height='100%' width='100%' cellspacing='0' cellpadding='0'>
  <tr height='99%' valign='top'>
    <td align='center'>
		
		<table style='margin-top: 4px' width=100% cellspacing=0 cellpadding=3>
   		<tr>
     		<td>PHP - <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BA%D1%83%D1%80%D1%81%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D0%B0%D0%BA%D1%80%D0%BE%D0%BD%D0%B8%D0%BC" target=_blank class=lnk>рекурсивный акроним</a> словосочетания &laquo;<a href="/manual/introduction.html" class=lnk>PHP: Hypertext Preprocessor</a>&raquo;</td>
     	</tr>
   		</table>

		<script language="JavaScript" src="http://www.php.ru/ajax/subsys_ajax.js"></script>
		<!--

		commet by 440hz
		20.10.2007

		<script language="JavaScript" src="http://www.php.ru/ajax/pu_search.js"></script>

		-->

		<script language="JavaScript" src="http://www.php.ru/ajax/cz.js?a=b"></script>

		<table style='margin-top: 5px' width=100% bgcolor=#9999cc cellspacing=0 cellpadding=0 border=0>
   	 	<form name=SEARCH method=GET action="http://www.php.ru/search/?SID=508wr9jv3vefffj2" onsubmit="return puSubmit();">
	  	<input type=hidden name=PAGE value=1>
  		<tr>
    		<td width='1' valign='middle'> 
    		   <a href='/'><img src="http://www.php.ru/;-)/logo.gif" width=133 height=93 alt="php" border=0 hspace=10 vspace=0></a>
			 </td>
		    <td width='100%' valign='middle'>
		       <!--
			   
				commet by 440hz
				20.10.2007

			   <div id='pu_search' class='pu_search'></div>
		       <div id='pu_search_description' class='pu_search_decription'></div>
			   
			   -->
        	 <input type=text style='width:99%; margin: 10px' maxlength='200' name='QS' class='in' id='query' autocomplete='off' value="" />
    		</td>
		  </tr>
   		<tr bgcolor='#666699' valign='middle'>
			<td style='border-top: 1px solid #333366;'><br /></td>
    		<td style='border-top: 1px solid #333366;'><div style="padding: 4px 4px 4px 10px; height: 24px; color: #CCCCFF;" id="stat">Хто там?<script>doLoadCZ('stat','stat');</script></div></td>
  		</tr>
		</form>
		</table>
		<table id="menu" cellspaciong=0 cellpadding=3>
<tr>
<td><a href="/" class=current>Главная</a></td>
<td><a href="/download/" class=current>Скачать</a></td>
<td><a href="/doc/" class=current>Документация</a></td>
<td><a href="/forum/" class=current>Форум</a></td>
<td width=100% align=right><a href="/phpinfo.html" class=current>phpinfo()</a></td>
</tr>
</table>

		
<!--  AdRiver code START. Type:728x90 Site: php.ru PZ: 0 BN: 1 -->
<script language="javascript" type="text/javascript"><!--
var RndNum4NoCash = Math.round(Math.random() * 1000000000);
var ar_Tail='unknown'; if (document.referrer) ar_Tail = escape(document.referrer);
document.write(
'<iframe src="http://ad.adriver.ru/cgi-bin/erle.cgi?'
+ 'sid=148680&bn=1&target=blank&bt=36&pz=0&rnd=' + RndNum4NoCash + '&tail256=' + ar_Tail
+ '" frameborder=0 vspace=0 hspace=0 width=728 height=90 marginwidth=0'
+ ' marginheight=0 scrolling=no></iframe>');
//--></script>
<noscript>
<a href="http://ad.adriver.ru/cgi-bin/click.cgi?sid=148680&bn=1&bt=36&pz=0&rnd=1525626915" target=_blank>
<img src="http://ad.adriver.ru/cgi-bin/rle.cgi?sid=148680&bn=1&bt=36&pz=0&rnd=1525626915" alt="-AdRiver-" border=0 width=728 height=90></a>
</noscript>
<!--  AdRiver code END  -->


  		<table width='100%' cellspacing='0' cellpadding='0'>
    		<tr valign='top'>
      		<td width=100%><div style="margin: 10px 10px 10px 50px;"><center><div style="width: 800px; text-align: left"><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Руководство по PHP</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="zend.variables.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Глава 46. Zend API: Hacking the Core of PHP</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="zend.returning.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="zend.copy-constructor"
>Duplicating Variable Contents: The Copy Constructor</A
></H1
><P
>&#13;   Sooner or later, you may need to assign the contents of one
   <VAR
CLASS="envar"
>zval</VAR
> container to another. This is easier said than
   done, since the <VAR
CLASS="envar"
>zval</VAR
> container doesn't contain only
   type information, but also references to places in Zend's internal
   data. For example, depending on their size, arrays and objects may
   be nested with lots of hash table entries. By assigning one
   <VAR
CLASS="envar"
>zval</VAR
> to another, you avoid duplicating the hash
   table entries, using only a reference to them (at most).
  </P
><P
>&#13;   To copy this complex kind of data, use the <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>copy
    constructor</I
></SPAN
>. Copy constructors are typically defined in
   languages that support operator overloading, with the express
   purpose of copying complex types. If you define an object in such a
   language, you have the possibility of overloading the "=" operator,
   which is usually responsible for assigning the contents of the
   rvalue (result of the evaluation of the right side of the operator)
   to the lvalue (same for the left side).
  </P
><P
>&#13;   <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>Overloading</I
></SPAN
> means assigning a different
   meaning to this operator, and is usually used to assign a function
   call to an operator. Whenever this operator would be used on such
   an object in a program, this function would be called with the
   lvalue and rvalue as parameters. Equipped with that information, it
   can perform the operation it intends the "=" operator to have
   (usually an extended form of copying).
  </P
><P
>&#13;   This same form of "extended copying" is also necessary for PHP's
   <VAR
CLASS="envar"
>zval</VAR
> containers. Again, in the case of an array,
   this extended copying would imply re-creation of all hash table
   entries relating to this array. For strings, proper memory
   allocation would have to be assured, and so on.
  </P
><P
>&#13;   Zend ships with such a function,
   called <B
CLASS="function"
>zend_copy_ctor()</B
> (the previous PHP equivalent
   was <B
CLASS="function"
>pval_copy_constructor()</B
>).
  </P
><P
>&#13;   A most useful demonstration is a function that accepts a complex type as
   argument, modifies it, and then returns the argument: 
  </P
><TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
CELLPADDING="5"
><TR
><TD
><PRE
CLASS="programlisting"
>zval *parameter;
   
if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "z", &#38;parameter) == FAILURE)
   return;
}
   
// do modifications to the parameter here

// now we want to return the modified container:
*return_value = *parameter;
zval_copy_ctor(return_value);</PRE
></TD
></TR
></TABLE
><P
>&#13;   The first part of the function is plain-vanilla argument retrieval.
   After the (left out) modifications, however, it gets interesting:
   The container of <VAR
CLASS="envar"
>parameter</VAR
> is assigned to the
   (predefined) <VAR
CLASS="envar"
>return_value</VAR
> container. Now, in order
   to effectively duplicate its contents, the copy constructor is
   called. The copy constructor works directly with the supplied
   argument, and the standard return values are
   <VAR
CLASS="literal"
>FAILURE</VAR
> on failure and
   <VAR
CLASS="literal"
>SUCCESS</VAR
> on success.
  </P
><P
>&#13;   If you omit the call to the copy constructor in this example, both
   <VAR
CLASS="envar"
>parameter</VAR
> and <VAR
CLASS="envar"
>return_value</VAR
> would
   point to the same internal data, meaning that
   <VAR
CLASS="envar"
>return_value</VAR
> would be an illegal additional
   reference to the same data structures. Whenever changes occurred in
   the data that <VAR
CLASS="envar"
>parameter</VAR
> points to,
   <VAR
CLASS="envar"
>return_value</VAR
> might be affected. Thus, in order to
   create separate copies, the copy constructor must be used.
  </P
><P
>&#13;   The copy constructor's counterpart in the Zend API, the destructor
   <B
CLASS="function"
>zval_dtor()</B
>, does the opposite of the
   constructor.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="zend.variables.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="zend.returning.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Creating Variables</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="zend.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Returning Values</TD
></TR
></TABLE
></DIV
></div></center></div></td>
			<td><div style="display:none; width:200px;" id="o3" name="o3"><script charset="windows-1251" type="text/javascript" src="http://www.ozon.ru/PartnerTwinerNew.aspx?revident=bea9126b-c8e1-4bf5-b6d8-9a057f8feac6" ></script></div><script>o = document.getElementById('o3'); if(o) { var s = o.innerHTML; s = s.replace(/F6F6F6/gi,"FFFFFF"); o.innerHTML = s.replace(/padding-top: 10px; padding-bottom: 10px;/,"display:none;"); o.style.display = 'block'; } </script><br><div style="margin: 10px;"><script type="text/javascript"><!--
google_ad_client = "pub-4093271809023514";
/* 120x600, создано 01.11.2008 */
google_ad_slot = "0438855731";
google_ad_width = 120;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script></div></td>
    		</tr>
  		</table>
    </td>
  </tr>
  <tr valign='bottom' height='1%'>
  <td>      <table width=100% cellspacing=0 cellpadding=5 border=0 bgcolor=#9999CC>
        <tr valign=center>
          <td class='phpcopyright' width='45%' align='left'>&nbsp;&nbsp;Engine <a  href="http://www.mnogosearch.org/">MnoGoSearch</a></td>
          <td class='phpcopyright' width='10%' align='center'>2007-2010 &copy <a  href="mailto:webmaster@php.ru">PHP.RU</a></td>
          <td class='phpcopyright' width='45%' align='right' >Powered by <a target="_blank" href="http://odware.ru">ODware</a> <a HREF="http://440hz.ru">440Hz</a> &nbsp;&nbsp;</td>
        </tr>
      </table>

    <div style="text-align: right; padding: 5px">
		<!--LiveInternet counter-->
		<script type="text/javascript">document.write('<a href="http://www.liveinternet.ru/click" target=_blank><img src="http://counter.yadro.ru/hit?t53.6;r' + escape(document.referrer) + ((typeof(screen)=='undefined')?'':';s'+screen.width+'*'+screen.height+'*'+(screen.colorDepth?screen.colorDepth:screen.pixelDepth)) + ';u' + escape(document.URL) +';i' + escape('Жж'+document.title.substring(0,80)) + ';' + Math.random() + '" border=0 width=88 height=31 alt="" title="LiveInternet: показано число просмотров и посетителей за 24 часа"><\/a>');
		</script>
		<!--/LiveInternet-->
		<!-- SpyLOG -->
		<script src="http://tools.spylog.ru/counter2.2.js" type="text/javascript" id="spylog_code" counter="830950" ></script>
		<noscript><a href="http://u8309.50.spylog.com/cnt?cid=830950&f=3&p=0" target="_blank"><img src="http://u8309.50.spylog.com/cnt?cid=830950&p=0&f=4" alt='SpyLOG' border='0' width=88 height=31 ></a>
		</noscript>
		<!--/ SpyLOG -->
	</div>
</td>
  </tr>
</table>

<script>
<!--
document.SEARCH.QS.focus();
// --></script>

<!-- 
	как же вы все это читаете?
	440hz 
-->

</body>
</html>