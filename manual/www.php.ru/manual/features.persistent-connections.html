<!-- 

     HTML dropped by Zend Guard Compressor 4.2

     php.ru team: mz, az, yuri, vb, cyxapuk, 440hz, administrator
     2004-2007 (c) expi-web.com 
     2007-2008 (c) odware.com 
     0101-1010 (с) 440hz

     2b|~2b=?


-->

























































































<!-- EHOT тут всё пожрал ! -->






















<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="alternate" type="application/rss+xml" title="php.ru/forum - последние сообщения" href="http://www.php.ru/forum/rss.php">
<link rel="SHORTCUT ICON" href="http://www.php.ru/favicon.ico" />
<META name="description" content="php.ru - форум PHP программистов, поиск по всем ресурсам сети, посвященным php">
<meta http-equiv="description" content="php.ru - форум PHP программистов, поиск по всем ресурсам сети, посвященным php">
<META name="keywords" content="php, php5, apache, mysql, session">
<meta http-equiv="keywords" content="php, php5, apache, mysql, session">
<title>php.ru - Постоянные соединения с базами данных</title>
<LINK REL="stylesheet" TYPE="text/css" HREF="http://www.php.ru/index.css">
<script language="JavaScript" src="http://www.php.ru/ajax/ajax.js"></script>
</head>
<body>

<table height='100%' width='100%' cellspacing='0' cellpadding='0'>
  <tr height='99%' valign='top'>
    <td align='center'>
		
		<table style='margin-top: 4px' width=100% cellspacing=0 cellpadding=3>
   		<tr>
     		<td>PHP - <a href="http://ru.wikipedia.org/wiki/%D0%A0%D0%B5%D0%BA%D1%83%D1%80%D1%81%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D0%B0%D0%BA%D1%80%D0%BE%D0%BD%D0%B8%D0%BC" target=_blank class=lnk>рекурсивный акроним</a> словосочетания &laquo;<a href="/manual/introduction.html" class=lnk>PHP: Hypertext Preprocessor</a>&raquo;</td>
     	</tr>
   		</table>

		<script language="JavaScript" src="http://www.php.ru/ajax/subsys_ajax.js"></script>
		<!--

		commet by 440hz
		20.10.2007

		<script language="JavaScript" src="http://www.php.ru/ajax/pu_search.js"></script>

		-->

		<script language="JavaScript" src="http://www.php.ru/ajax/cz.js?a=b"></script>

		<table style='margin-top: 5px' width=100% bgcolor=#9999cc cellspacing=0 cellpadding=0 border=0>
   	 	<form name=SEARCH method=GET action="http://www.php.ru/search/?SID=1ws8j0ospwkfyo3f" onsubmit="return puSubmit();">
	  	<input type=hidden name=PAGE value=1>
  		<tr>
    		<td width='1' valign='middle'> 
    		   <a href='/'><img src="http://www.php.ru/;-)/logo.gif" width=133 height=93 alt="php" border=0 hspace=10 vspace=0></a>
			 </td>
		    <td width='100%' valign='middle'>
		       <!--
			   
				commet by 440hz
				20.10.2007

			   <div id='pu_search' class='pu_search'></div>
		       <div id='pu_search_description' class='pu_search_decription'></div>
			   
			   -->
        	 <input type=text style='width:99%; margin: 10px' maxlength='200' name='QS' class='in' id='query' autocomplete='off' value="" />
    		</td>
		  </tr>
   		<tr bgcolor='#666699' valign='middle'>
			<td style='border-top: 1px solid #333366;'><br /></td>
    		<td style='border-top: 1px solid #333366;'><div style="padding: 4px 4px 4px 10px; height: 24px; color: #CCCCFF;" id="stat">Хто там?<script>doLoadCZ('stat','stat');</script></div></td>
  		</tr>
		</form>
		</table>
		<table id="menu" cellspaciong=0 cellpadding=3>
<tr>
<td><a href="/" class=current>Главная</a></td>
<td><a href="/download/" class=current>Скачать</a></td>
<td><a href="/doc/" class=current>Документация</a></td>
<td><a href="/forum/" class=current>Форум</a></td>
<td width=100% align=right><a href="/phpinfo.html" class=current>phpinfo()</a></td>
</tr>
</table>

		
<!--  AdRiver code START. Type:728x90 Site: php.ru PZ: 0 BN: 1 -->
<script language="javascript" type="text/javascript"><!--
var RndNum4NoCash = Math.round(Math.random() * 1000000000);
var ar_Tail='unknown'; if (document.referrer) ar_Tail = escape(document.referrer);
document.write(
'<iframe src="http://ad.adriver.ru/cgi-bin/erle.cgi?'
+ 'sid=148680&bn=1&target=blank&bt=36&pz=0&rnd=' + RndNum4NoCash + '&tail256=' + ar_Tail
+ '" frameborder=0 vspace=0 hspace=0 width=728 height=90 marginwidth=0'
+ ' marginheight=0 scrolling=no></iframe>');
//--></script>
<noscript>
<a href="http://ad.adriver.ru/cgi-bin/click.cgi?sid=148680&bn=1&bt=36&pz=0&rnd=1525626915" target=_blank>
<img src="http://ad.adriver.ru/cgi-bin/rle.cgi?sid=148680&bn=1&bt=36&pz=0&rnd=1525626915" alt="-AdRiver-" border=0 width=728 height=90></a>
</noscript>
<!--  AdRiver code END  -->


  		<table width='100%' cellspacing='0' cellpadding='0'>
    		<tr valign='top'>
      		<td width=100%><div style="margin: 10px 10px 10px 50px;"><center><div style="width: 800px; text-align: left"><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Руководство по PHP</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="features.connection-handling.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="features.safe-mode.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="chapter"
><H1
><A
NAME="features.persistent-connections"
>Глава 41. Постоянные соединения с базами данных</A
></H1
><P
>&#13;   Постоянные соединения представляют собой связи с базами данных,
   которые не закрываются при завершении скрипта. При получении запроса
   на постоянное соединение PHP вначале проверяет, имеется ли
   идентичное постоянное соединение (которое было открыто при предыдущих
   обращениях) и, если таковое было найдено, использует его.
   В случае, если идентичного соединения нет, PHP создает новое. Под
   "идентичным" подразумевается соединение, открытое на тот же хост с 
   таким же именем пользователя и паролем (если они указаны).
  </P
><P
>&#13;   Та часть разработчиков, которая не имеет четкого представления о том,
   как работает веб-сервер и как распределяется нагрузка, могут получить
   ошибочное представление о том, чем на самом деле являются постоянные 
   соединения. В частности, постоянные соединения <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>не</I
></SPAN
> 
   предоставляют возможность открывать 'пользовательские сессии' в том же 
   самом соединении, они <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>не</I
></SPAN
> предоставляют возможность
   организовывать более эффективные транзакции, также они не предоставляют 
   множества других полезных возможностей. Фактически, постоянные соединения
   не предоставляют <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>никакой</I
></SPAN
> функциональности, которая 
   была бы невозможна в непостоянных аналогичных соединениях.
  </P
><P
>&#13;   Почему?
  </P
><P
>&#13;   Это зависит от того, как происходит взаимодействие с веб-сервером. Существует
   три основных способа использования PHP сервером для генерации веб-страниц.
  </P
><P
>&#13;   Первый способ заключается в том, чтобы использовать PHP как CGI-оболочку.
   При этом PHP-интерпретатор создается и уничтожается при каждом 
   обращении к странице (PHP-скрипту). Поскольку интерпретатор
   уничтожается после каждого запроса к серверу, все используемые им ресурсы
   (в том числе и соединение с базой данных) закрывается. Следовательно,
   в этом случае вы не получите ничего от использования постоянных соединений - 
   их просто нет.
  </P
><P
>&#13;   Второй, и наиболее популярный способ - использовать PHP как модуль
   в сервере, который использует несколько процессов. В число таких серверов 
   сейчас входит только Apache. В таком случае, можно выделить один процесс 
   (родительский), который координирует работу всех остальных процессов 
   (дочерних), которые фактически и выполняют работу по обслуживанию веб-страниц.
   При каждом обращении клиента к серверу запрос перенаправляется одному из
   дочерних процессов, который в данный момент не занят обслуживанием другого
   клиента. Это означает, что когда тот же самый клиент выполняет повторный 
   запрос к серверу, он может быть обработан другим дочерним процессом, отличным
   от того, который был при первом обращении. После открытия постоянного
   соединения каждая последующая страница, требующая соединения с базой данных,
   может использовать уже установленное ранее соединение с SQL-сервером.
  </P
><P
>&#13;   Третий способ - использовать PHP в качестве плугина в многопоточном
   веб-сервере. В настоящее время в PHP4 реализована поддержка ISAPI, 
   WSAPI, и NSAPI (для Windows-платформ), которые позволяют 
   подключать PHP к таким многопоточным серверам, как Netscape FastTrack 
   (iPlanet), Microsoft's Internet Information  Server (IIS) и 
   O'Reilly WebSite Pro. В этом случае поведение PHP полностью аналогично
   рассмотренной ранее модели с использованием нескольких процессов.
   Следует заметить, что поддержка  SAPI отсутствует в PHP 3.
  </P
><P
>&#13;   Если постоянные соединения не предоставляют никакой дополнительной функциональности,
   чем же они тогда так хороши?
  </P
><P
>&#13;   Ответ содержится в повышении эффективности. Постоянные соединения
   полезны в том случае, если при открытии большого количества SQL-соединений
   возникает ощутимая нагрузка на сервер. То, насколько велика эта нагрузка,
   зависит от многих факторов. Например, от того, какая именно база данных
   используется, находится ли она на том же компьютере что и ваш веб-сервер,
   насколько загружена машина, на которой установлен SQL-сервер, и так далее.
   В случае, если затраты на установку соединения велики, постоянные соединения
   могут вам существенно помочь. Они позволяют дочернему процессу на 
   протяжении всего жизненного цикла использовать одно и то же соединение
   вместо того, чтобы создавать его при обработке каждой страницы,
   которая взаимодействует с SQL-сервером. Это означает, что каждый дочерний 
   процесс, открывший постоянное соединение, будет иметь свое собственное 
   соединение с сервером. Например, если у вас запущено 20 дочерних процессов,
   которые выполнили скрипт, использовавший постоянное соединение с SQL-сервером,
   вы получите 20 различных соединений с SQL-сервером, по одному на каждый дочерний
   процесс.
  </P
><P
>&#13;   Следует заметить, что этот подход имеет некоторые недостатки: если
   вы используете базу данных с ограниченным количеством возможных 
   подключений, оно может быть превышено количеством запрашиваемых 
   дочерними процессами постоянных соединений. Например, если ваша база
   данных позволяет 16 одновременных соединений, и во время нагрузки
   на сервер 17 дочерних процессов попробуют открыть соединение, одна из
   попыток потерпит неудачу. Если в вашем коде содержатся ошибки, не позволяющие
   закрывать соединение (например, бесконечные циклы), база данных с
   32 одновременными подключениями вскоре может оказаться заблокированной. 
   Информацию о том, как обрабатывать открытые и неиспользумые соединения, вы можете 
   найти в документации к вашей базе данных
  </P
><DIV
CLASS="warning"
><P
></P
><TABLE
CLASS="warning"
BORDER="1"
WIDTH="100%"
><TR
><TD
ALIGN="CENTER"
><B
>Внимание</B
></TD
></TR
><TR
><TD
ALIGN="LEFT"
><P
>&#13;    Есть еще два дополнительных предостережения, которые следует 
    помнить при работе с постоянными соединениями. В случае, если скрипт
    блокирует таблицу и по каким-либо причинам не может ее освободить,
    при использовании постоянного соединения все последующие скрипты,
    которые используют это соединение будут  блокированы бесконечно
    долго и могут потребовать рестарта веб-сервера или сервера баз данных.
    Второе предостережение заключается в том, что открытые транзакции, 
    если они не были закрыты до завершения работы скрипта, будут продолжены
    в следующем скрипте, использующем это же постоянное соединение.
    Исходя из этого, вы можете использовать функцию 
    <A
HREF="function.register-shutdown-function.html"
><B
CLASS="function"
>register_shutdown_function()</B
></A
> для указания простой функции,
    которая снимает блокировку таблиц или отката ваших транзакций.
    Еще лучше избежать этих проблем полностью, не используя постоянные
    соединения в скриптах, которые используют блокировку таблиц или транзакции
    (при этом вы все еще можете использовать их где-то в другом месте).
   </P
></TD
></TR
></TABLE
></DIV
><P
>&#13;   Важное резюме. Постоянные соединения были созданы для точного отображения
   обыкновенных соединений. Это означает, что у вас <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>всегда</I
></SPAN
> 
   есть возможность заменить все постоянные соединения непостоянными, и это 
   никак не отразится на поведении скрипта. Такая замена <SPAN
CLASS="emphasis"
><I
CLASS="emphasis"
>может</I
></SPAN
> 
   повлиять (и, наверное, таки повлияет) на эффективность работы скрипта, но
   никак не на его поведение.
  </P
><P
>&#13;   Смотрите также <A
HREF="function.fbsql-pconnect.html"
><B
CLASS="function"
>fbsql_pconnect()</B
></A
>,
   <A
HREF="function.ibase-pconnect.html"
><B
CLASS="function"
>ibase_pconnect()</B
></A
>, <A
HREF="function.ifx-pconnect.html"
><B
CLASS="function"
>ifx_pconnect()</B
></A
>,
   <A
HREF="function.ingres-pconnect.html"
><B
CLASS="function"
>ingres_pconnect()</B
></A
>,
   <A
HREF="function.msql-pconnect.html"
><B
CLASS="function"
>msql_pconnect()</B
></A
>, <A
HREF="function.mssql-pconnect.html"
><B
CLASS="function"
>mssql_pconnect()</B
></A
>,
   <A
HREF="function.mysql-pconnect.html"
><B
CLASS="function"
>mysql_pconnect()</B
></A
>, <A
HREF="function.ociplogon.html"
><B
CLASS="function"
>ociplogon()</B
></A
>,
   <A
HREF="function.odbc-pconnect.html"
><B
CLASS="function"
>odbc_pconnect()</B
></A
>, <A
HREF="function.ora-plogon.html"
><B
CLASS="function"
>ora_plogon()</B
></A
>,
   <A
HREF="function.pfsockopen.html"
><B
CLASS="function"
>pfsockopen()</B
></A
>, <A
HREF="function.pg-pconnect.html"
><B
CLASS="function"
>pg_pconnect()</B
></A
>, и
   <A
HREF="function.sybase-pconnect.html"
><B
CLASS="function"
>sybase_pconnect()</B
></A
>.
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="features.connection-handling.html"
ACCESSKEY="P"
>Пред.</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Начало</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="features.safe-mode.html"
ACCESSKEY="N"
>След.</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Работа с соединениями</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="features.html"
ACCESSKEY="U"
>Уровень выше</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Защищенный режим</TD
></TR
></TABLE
></DIV
></div></center></div></td>
			<td><div style="display:none; width:200px;" id="o3" name="o3"><script charset="windows-1251" type="text/javascript" src="http://www.ozon.ru/PartnerTwinerNew.aspx?revident=bea9126b-c8e1-4bf5-b6d8-9a057f8feac6" ></script></div><script>o = document.getElementById('o3'); if(o) { var s = o.innerHTML; s = s.replace(/F6F6F6/gi,"FFFFFF"); o.innerHTML = s.replace(/padding-top: 10px; padding-bottom: 10px;/,"display:none;"); o.style.display = 'block'; } </script><br><div style="margin: 10px;"><script type="text/javascript"><!--
google_ad_client = "pub-4093271809023514";
/* 120x600, создано 01.11.2008 */
google_ad_slot = "0438855731";
google_ad_width = 120;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script></div></td>
    		</tr>
  		</table>
    </td>
  </tr>
  <tr valign='bottom' height='1%'>
  <td>      <table width=100% cellspacing=0 cellpadding=5 border=0 bgcolor=#9999CC>
        <tr valign=center>
          <td class='phpcopyright' width='45%' align='left'>&nbsp;&nbsp;Engine <a  href="http://www.mnogosearch.org/">MnoGoSearch</a></td>
          <td class='phpcopyright' width='10%' align='center'>2007-2010 &copy <a  href="mailto:webmaster@php.ru">PHP.RU</a></td>
          <td class='phpcopyright' width='45%' align='right' >Powered by <a target="_blank" href="http://odware.ru">ODware</a> <a HREF="http://440hz.ru">440Hz</a> &nbsp;&nbsp;</td>
        </tr>
      </table>

    <div style="text-align: right; padding: 5px">
		<!--LiveInternet counter-->
		<script type="text/javascript">document.write('<a href="http://www.liveinternet.ru/click" target=_blank><img src="http://counter.yadro.ru/hit?t53.6;r' + escape(document.referrer) + ((typeof(screen)=='undefined')?'':';s'+screen.width+'*'+screen.height+'*'+(screen.colorDepth?screen.colorDepth:screen.pixelDepth)) + ';u' + escape(document.URL) +';i' + escape('Жж'+document.title.substring(0,80)) + ';' + Math.random() + '" border=0 width=88 height=31 alt="" title="LiveInternet: показано число просмотров и посетителей за 24 часа"><\/a>');
		</script>
		<!--/LiveInternet-->
		<!-- SpyLOG -->
		<script src="http://tools.spylog.ru/counter2.2.js" type="text/javascript" id="spylog_code" counter="830950" ></script>
		<noscript><a href="http://u8309.50.spylog.com/cnt?cid=830950&f=3&p=0" target="_blank"><img src="http://u8309.50.spylog.com/cnt?cid=830950&p=0&f=4" alt='SpyLOG' border='0' width=88 height=31 ></a>
		</noscript>
		<!--/ SpyLOG -->
	</div>
</td>
  </tr>
</table>

<script>
<!--
document.SEARCH.QS.focus();
// --></script>

<!-- 
	как же вы все это читаете?
	440hz 
-->

</body>
</html>